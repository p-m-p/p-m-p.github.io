<!doctype html>
<html lang="en-GB">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generating entry points for TypeScript packages</title>
  <meta name="description" content="Consuming NPM packages that export JavaScript Modules (ESM) with bundlers like Vite and Webpack is simple enough but to author a package in TypeScript with ESM only exports there&#39;s a few things that need to be considered.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://philparsons.co.uk/blog/typescript-package-entry-points/">
  <meta property="og:title" content="Generating entry points for TypeScript packages">
  <meta property="og:description" content="Consuming NPM packages that export JavaScript Modules (ESM) with bundlers like Vite and Webpack is simple enough but to author a package in TypeScript with ESM only exports there&#39;s a few things that need to be considered.">
  <meta property="og:image" content="https://philparsons.co.uk/img/socialcard/home.jpg">

  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://philparsons.co.uk/blog/typescript-package-entry-points/">
  <meta property="twitter:title" content="Generating entry points for TypeScript packages">
  <meta property="twitter:description" content="Consuming NPM packages that export JavaScript Modules (ESM) with bundlers like Vite and Webpack is simple enough but to author a package in TypeScript with ESM only exports there&#39;s a few things that need to be considered.">
  <meta property="twitter:image" content="https://philparsons.co.uk/img/socialcard/home.jpg">

  <link rel="icon" href="/img/icon.png">
  <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Phil Parsons">
  <style>.ctc-image {
  &::part(button) {
    opacity: 0;
    background: rgb(0 0 0 / 80%);
    transition: opacity 150ms;
  }

  &:hover::part(button) {
    opacity: 1;
  }
}

copy-to-clipboard {
  --ctc-button-color: var(--color-text-primary);
}

back-to-top {
  --btt-button-background: var(--color-bg-secondary);
  --btt-button-background-hover: light-dark(rgb(0 0 0 / 20%), rgb(0 0 0 / 80%));
  --btt-button-color: var(--color-text-primary);
}

figcaption {
  font-size: 0.875rem;
  text-align: center;
}

.container {
  margin: 0 auto;
  max-width: 1024px;
  padding: 0 1rem;
}

.banner {
  align-items: center;
  display: flex;
  gap: 1rem;
  justify-content: space-between;
  padding: 0.5rem 1rem;

  a {
    color: var(--color-text-primary);
    display: inline-flex;
    text-decoration: none;
    transition:
      transform 200ms,
      color 200ms;

    &:visited {
      color: var(--color-text-primary);
    }

    &:hover {
      color: var(--color-link-hover);
    }
  }
}

.logo {
  font-size: 1.5rem;
  font-weight: 400;
  line-height: 1;

  &:hover {
    transform: scale(1.05);
  }
}

.nav {
  align-items: center;
  display: flex;
  flex: 1;
  gap: 1rem;
  justify-content: flex-end;

  a {
    line-height: 1;

    &:hover {
      transform: scale(1.25);
    }
  }
}

.post {
  max-width: 100%;
  overflow: clip;
}

.post-header {
  background: var(--color-bg-secondary);
  margin: 0 0 1rem;
  padding: 1rem 0 0;
}

.post-title {
  font-size: 3rem;
  font-weight: 700;
  line-height: 1.1;
}

.post-meta {
  align-items: baseline;
  display: flex;
  gap: 1rem;
  justify-content: right;
  padding: 1rem 0 0.5rem;
}

.post-date {
  color: var(--color-text-secondary);
  font-size: 0.875rem;
}

.post-content {
  p {
    margin: 0 0 1rem;
    text-wrap: pretty;

    code {
      font-size: 0.875rem;
    }
  }

  h2,
  h3,
  h4 {
    font-weight: 600;
    margin: 2rem 0 1rem;
    text-wrap: pretty;
  }

  h2 {
    font-size: 1.75rem;
    line-height: 1.2;
  }

  h3 {
    font-size: 1.25rem;
    line-height: 1.4;
  }

  h4 {
    font-size: 1rem;
    line-height: 1.4;
  }

  pre {
    font-size: 0.875rem;
    margin: 0 0 2rem;
    overflow: auto;
    padding: 0.5rem;
  }

  img {
    background: var(--color-bg-secondary);
    height: auto;
    margin: 0 auto;
    max-width: 100%;
    padding: 1rem;
  }
}

.post-description {
  color: var(--color-text-secondary);
  font-size: 1.125rem;
  line-height: 1.4;
}

.post-footer {
  background: var(--color-bg-secondary);
  border-top: solid 1px var(--color-border-primary);
  padding: 1rem 0;
}

.licence {
  line-height: 1.75;
}

#share-fallback {
  background: black;
  border: none;
  border-radius: 1rem;
  left: 50%;
  min-width: 280px;
  padding: 2rem;
  top: 50%;
  transform: translate(-50%, -50%);

  &::backdrop {
    background: rgb(0 0 0 / 40%);
  }
}

.share-fallback-title {
  font-size: 1.25rem;
  margin: 0 0 0.5rem;
}

.share-fallback-links {
  display: flex;
  flex-flow: column;
  gap: 0.5rem;
  list-style: none;
  margin: 0;
  padding: 0;

  a,
  a:visited,
  a:hover {
    color: white;
    text-decoration: none;
  }
}

.share-btn {
  align-items: center;
  background: light-dark(var(--color-neutral-100), var(--color-neutral-700));
  border: none;
  border-radius: 999px;
  color: var(--color-text-primary);
  cursor: pointer;
  display: inline-flex;
  font-weight: 500;
  font-size: 0.875rem;
  gap: 0.5rem;
  line-height: 1;
  padding: 0.25rem 0.75rem;
  transition:
    background 200ms,
    color 200ms;

  &:hover {
    background: light-dark(var(--color-primary-100), var(--color-primary-500));
  }
}

.theme-switcher {
  min-height: 2.5rem;
  min-width: 4.375rem;
}

theme-switch {
  --ts-button-color: var(--color-text-primary);
  --ts-button-size: 1.25rem;
  --ts-button-bar-background: var(--color-bg-secondary);
  --ts-button-bar-lozenge: var(--color-bg-primary);
}

@media (pointer: coarse) {
  .theme-switcher {
    min-width: 2.5rem;
  }

  theme-switch {
    --ts-lozenge-background: transparent;

    &::part(button) {
      opacity: 1;
    }

    &::part(button dark) {
      position: absolute;
      top: 0;
      left: 0;
    }

    &[data-theme="dark"] {
      &::part(button dark) {
        visibility: hidden;
      }
    }

    &[data-theme="light"] {
      &::part(button light) {
        visibility: hidden;
      }
    }
  }
}

@media (width >=600px) {
  .post-header {
    padding: 2rem 0 0;
    margin: 0 0 2rem;
  }
}

@media (width >=1024px) {
  .post-content {
    font-size: 1.125rem;

    p {
      code {
        font-size: 1rem;
      }
    }

    pre {
      padding: 1rem;
    }

    h2 {
      font-size: 2rem;
    }
  }

  .post-title {
    font-size: 4rem;
  }

  .post-description {
    font-size: 1.5rem;
  }
}

@keyframes zoom-title {
  to {
    transform: rotate(-10deg) scale(1.5);
    opacity: 0.5;
  }
}

@supports (animation-timeline: scroll()) {
  .post-header {
    animation: zoom-title linear both;
    animation-timeline: scroll();
    animation-range: 0 500px;
  }
}
/**
 * a11y-dark theme for JavaScript, CSS, and HTML
 * Based on the okaidia theme: https://github.com/PrismJS/prism/blob/gh-pages/themes/prism-okaidia.css
 * @author ericwbailey
 */

code[class*="language-"],
pre[class*="language-"] {
  color: #f8f8f2;
  background: none;
  font-family: Consolas, Monaco, "Andale Mono", "Ubuntu Mono", monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

:not(pre)>code[class*="language-"],
pre[class*="language-"] {
  background: var(--codeblock-bg);
}

/* Inline code */
:not(pre)>code[class*="language-"] {
  padding: 0.1em;
  border-radius: 0.3em;
  white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
  color: #d4d0ab;
}

.token.punctuation {
  color: #fefefe;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
  color: #ffa07a;
}

.token.boolean,
.token.number {
  color: #00e0e0;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
  color: #abe338;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
  color: #00e0e0;
}

.token.atrule,
.token.attr-value,
.token.function {
  color: #ffd700;
}

.token.keyword {
  color: #00e0e0;
}

.token.regex,
.token.important {
  color: #ffd700;
}

.token.important,
.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}

.token.entity {
  cursor: help;
}

@media screen and (-ms-high-contrast: active) {

  code[class*="language-"],
  pre[class*="language-"] {
    color: windowText;
    background: window;
  }

  :not(pre)>code[class*="language-"],
  pre[class*="language-"] {
    background: window;
  }

  .token.important {
    background: highlight;
    color: window;
    font-weight: normal;
  }

  .token.atrule,
  .token.attr-value,
  .token.function,
  .token.keyword,
  .token.operator,
  .token.selector {
    font-weight: bold;
  }

  .token.attr-value,
  .token.comment,
  .token.doctype,
  .token.function,
  .token.keyword,
  .token.operator,
  .token.property,
  .token.string {
    color: highlight;
  }

  .token.attr-value,
  .token.url {
    font-weight: normal;
  }
}
:root {
  color-scheme: light dark;

  --color-stone: lch(50% 1.5 75);
  --color-peach: lch(55% 48 38);

  --color-white: lch(99% 4 75);
  --color-black: lch(2% 4 75);

  --color-primary-50: lch(from var(--color-peach) 95% c h);
  --color-primary-100: lch(from var(--color-peach) 90% c h);
  --color-primary-200: lch(from var(--color-peach) 80% c h);
  --color-primary-300: lch(from var(--color-peach) 70% c h);
  --color-primary-400: lch(from var(--color-peach) 60% c h);
  --color-primary-500: lch(from var(--color-peach) l c h);
  --color-primary-600: lch(from var(--color-peach) 40% c h);
  --color-primary-700: lch(from var(--color-peach) 30% c h);
  --color-primary-800: lch(from var(--color-peach) 20% c h);
  --color-primary-900: lch(from var(--color-peach) 10% c h);
  --color-primary-950: lch(from var(--color-peach) 5% c h);

  --color-neutral-50: lch(from var(--color-stone) 95% c h);
  --color-neutral-100: lch(from var(--color-stone) 90% c h);
  --color-neutral-200: lch(from var(--color-stone) 80% c h);
  --color-neutral-300: lch(from var(--color-stone) 70% c h);
  --color-neutral-400: lch(from var(--color-stone) 60% c h);
  --color-neutral-500: lch(from var(--color-stone) l c h);
  --color-neutral-600: lch(from var(--color-stone) 40% c h);
  --color-neutral-700: lch(from var(--color-stone) 30% c h);
  --color-neutral-800: lch(from var(--color-stone) 20% c h);
  --color-neutral-900: lch(from var(--color-stone) 10% c h);
  --color-neutral-950: lch(from var(--color-stone) 5% c h);

  --color-border-primary: light-dark(var(--color-neutral-200),
      var(--color-neutral-700));

  --color-bg-primary: light-dark(var(--color-white), var(--color-neutral-800));
  --color-bg-secondary: light-dark(var(--color-neutral-50),
      var(--color-neutral-900));

  --color-link: var(--color-text-primary);
  --color-link-hover: light-dark(var(--color-primary-600),
      var(--color-primary-100));
  --color-link-underline: var(--color-primary-400);
  --color-link-hover-underline: light-dark(var(--color-primary-600),
      var(--color-primary-300));
  --color-link-visited: light-dark(var(--color-primary-600),
      var(--color-primary-100));
  --color-link-visited-underline: var(--color-primary-400);
  --color-link-focus: var(--color-link-hover);
  --color-link-focus-underline: var(--color-link-hover);

  --color-text-primary: light-dark(var(--color-black), var(--color-white));
  --color-text-secondary: light-dark(var(--color-neutral-600),
      var(--color-neutral-200));

  --codeblock-bg: var(--color-neutral-900);
}

.dark {
  color-scheme: dark;
}

.light {
  color-scheme: light;
}

*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
}

body {
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
  font-family: "Noto Sans", sans-serif;
  font-optical-sizing: auto;
  font-size: 16px;
  font-style: normal;
  font-variation-settings: "wdth" 100;
  font-weight: 400;
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
}

a {
  color: var(--color-link);
  font-weight: 500;
  text-decoration: underline;
  text-underline-offset: 0.25rem;
  text-decoration-color: var(--color-link-underline);
  transition:
    text-decoration-color 200ms,
    color 200ms;

  &:visited {
    color: var(--color-link-visited);
    text-decoration-color: var(--color-link-visited-underline);
    font-weight: 400;
  }

  &:focus-visible {
    color: var(--color-link-focus);
    text-decoration-color: var(--color-link-focus-underline);
  }

  &:active {
    position: relative;
    top: 0.125rem;
  }
}

@media (hover: hover) {
  a:hover {
    color: var(--color-link-hover);
    text-decoration-color: var(--color-link-hover-underline);
  }
}</style>
  <script defer="" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "86e36e0634bb461e84a1b6a61f287b46"}'></script>

  <title>Generating entry points for TypeScript packages</title>
</head>

<body>
  
<div class="banner container">
  <a class="logo" href="/">Phil Parsons</a>

  <nav class="nav">
    <a href="https://github.com/p-m-p" aria-label="Github profile">
      <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg>
    </a>
    <a href="https://linkedin.com/in/phil-parsons-webdev" aria-label="LinkedIn profile">
      <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </a>
    <a href="/feed/feed.xml" aria-label="RSS XML feed">
      <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg>
    </a>
  </nav>

  <div class="theme-switcher">
    <theme-switch data-strategy="class"></theme-switch>
  </div>
</div>

<article class="post">
  <header class="post-header">
    <div class="container">
      <h1 class="post-title">Generating entry points for TypeScript packages</h1>

      <div class="post-meta">
        <div class="post-date"><time datetime="2024-10-27">27 October 2024</time></div>

        <share-button>
          <button class="share-btn" slot="button" popovertarget="share-fallback">
            Share
            <span class="share-btn-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 17 20 12 15 7"></polyline><path d="M4 18v-2a4 4 0 0 1 4-4h12"></path></svg>
            </span>
          </button>

          <div popover="" id="share-fallback">
            <h2 class="share-fallback-title">Share this post</h2>
            <ul class="share-fallback-links">
              <li>
                <a href="https://bsky.app/intent/compose?text=Generating%20entry%20points%20for%20TypeScript%20packages%20https://philparsons.co.uk//blog/typescript-package-entry-points/">ü¶ã Share on Bluesky</a>
              </li>
              <li>
                <a href="https://www.linkedin.com/shareArticle?url=https://philparsons.co.uk//blog/typescript-package-entry-points/&title=Generating%20entry%20points%20for%20TypeScript%20packages">üè¢ Share on LinkedIn</a>
              </li>
              <li>
                <a href="https://x.com/intent/post?url=https://philparsons.co.uk//blog/typescript-package-entry-points/&text=Generating%20entry%20points%20for%20TypeScript%20packages&via=phil_parsons">
                  üí© Share on X
                </a>
              </li>
            </ul>
          </div>
        </share-button>
      </div>
    </div>
  </header>

  <main class="post-content container">
    <p class="post-description">Consuming NPM packages that export JavaScript Modules (ESM) with bundlers like Vite and Webpack is simple enough but to author a package in TypeScript with ESM only exports there&#39;s a few things that need to be considered.</p>
    <h2>TypeScript vs JavaScript module resolution</h2>
<p>TypeScript generally has the same import syntax as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules">JavaScript
modules</a> with additional features from CommonJS that aren't
supported in JavaScript modules.</p>
<p>Take this basic example of a library module structure.</p>
<copy-to-clipboard><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">.</span>
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îú‚îÄ‚îÄ feature
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Component.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îî‚îÄ‚îÄ tsconfig.json</code></pre></copy-to-clipboard>
<p>With TypeScript it's possible to import from the directory via it's index file
or from another file without the extension.</p>
<copy-to-clipboard><pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./feature"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Component <span class="token keyword">from</span> <span class="token string">"./feature/Component"</span><span class="token punctuation">;</span></code></pre></copy-to-clipboard>
<p>JavaScript modules require the full path and the file extension.</p>
<copy-to-clipboard><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./feature/index.js"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Component <span class="token keyword">from</span> <span class="token string">"./feature/Component.js"</span><span class="token punctuation">;</span></code></pre></copy-to-clipboard>
<p>To export JavaScript modules from the compiled TypeScript all import statements
need to use the ESM syntax. To do this the TypeScript configuration option for
<code>module</code> needs to be set to <code>nodenext</code> as does <code>moduleResolution</code> (see <a href="https://www.typescriptlang.org/docs/handbook/modules/theory.html#module-resolution-for-libraries">Module
resolution for libraries</a>).</p>
<p>You'd be easily mistaken here to think that compiling with other module settings
work fine when consuming the library with a bundler that doesn't apply the
strict ESM resolution algorithm but when used with Node.js it will result in
module import errors.</p>
<p>Here's an example of a minimal TypeScript configuration for compiling to
JavaScript modules.</p>
<copy-to-clipboard><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"node"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"nodenext"</span><span class="token punctuation">,</span>
    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"nodenext"</span><span class="token punctuation">,</span>
    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"esnext"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></copy-to-clipboard>
<p>It seems weird importing <code>.ts</code> and <code>.tsx</code> files with a <code>.js</code> extension, and
there are other ways to fix the import paths via plugins for bundlers like
ESBuild and Rollup, but it does at least make the intent explicit.</p>
<h2>Packaging library modules</h2>
<p>A common solution for exposing library modules is to use a bundler to create a
single entry point. This is fine, and possibly even preferred, for small
packages but on a larger scale for packages with many modules exporting them
individually will help to reduce unused JavaScript and optimise build
performance through <a href="https://developer.mozilla.org/en-US/docs/Glossary/Tree_shaking">tree shaking</a>.</p>
<h3>Build options</h3>
<p>If the compiled JavaScript files are relative to package.json they could be
imported from the file system path.</p>
<copy-to-clipboard><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"myLib/feature/index.js"</span><span class="token punctuation">;</span></code></pre></copy-to-clipboard>
<p>It can get messy with this approach, having the compiled files strewn across the
project during development. Some of this can be overcome with <a href="https://git-scm.com/docs/gitignore">Git
ignore</a> rules and use of the <a href="https://docs.npmjs.com/cli/v10/configuring-npm/package-json#files">files configuration</a> in
package.json but it also means a key advantage of the module pattern is lost,
<a href="https://en.wikipedia.org/wiki/Information_hiding">information hiding</a>.</p>
<p>Node.js modules are able to provide a map of
<a href="entry-points">package entry points</a> in package.json to expose only the public
modules. When using this approach the compiled JavaScript modules can be output
to a separate build directory.</p>
<p>Here's an example package.json with entry points for the JavaScript modules
compiled to a directory named <code>dist</code>.</p>
<copy-to-clipboard><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"myLib"</span><span class="token punctuation">,</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  <span class="token property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"dist"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"exports"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"."</span><span class="token operator">:</span> <span class="token string">"./dist/index.js"</span><span class="token punctuation">,</span>
    <span class="token property">"./feature"</span><span class="token operator">:</span> <span class="token string">"./dist/feature/index.js"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></copy-to-clipboard>
<p>Now it's possible to import the package modules from the named entry points,
noticeably without the file name and extension.</p>
<copy-to-clipboard><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> ComponentA <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"myLib/componentA"</span><span class="token punctuation">;</span></code></pre></copy-to-clipboard>
<h3>Automated entry point generation</h3>
<p>Maintaining the entry points manually will be a burden that likely becomes a
source of errors with keeping things in sync. Automating the generation of the
package entry points removes this risk but presents a new problem, the need to
update package.json.</p>
<p>Generating the entry points and updating package.json could run as a
<a href="https://docs.npmjs.com/cli/v9/using-npm/scripts#pre--post-scripts">prepublish</a> phase, a <a href="https://git-scm.com/book/ms/v2/Customizing-Git-Git-Hooks">pre-commit hook</a> or on
a build server. Given there is a separate <code>dist</code> directory another approach is
to create a package.json in that directory and publish the package from there.</p>
<p>This Node.js script generates the entry points and writes a new package.json
file in the <code>dist</code> directory. All public modules under the <code>src</code> directory
contain an <code>index.ts</code> file and this is used as the entry point.</p>
<copy-to-clipboard><pre class="language-js"><code class="language-js"><span class="token comment">// generateExports.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> copyFile<span class="token punctuation">,</span> readFile<span class="token punctuation">,</span> writeFile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"fs/promises"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> join <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"path"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> glob <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"glob"</span><span class="token punctuation">;</span> <span class="token comment">// npm install -D glob</span>

<span class="token comment">// Assumes the script is in the project root and the TypeScript</span>
<span class="token comment">// files have been compiled into a directory named dist</span>
<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>dirname<span class="token punctuation">;</span>
<span class="token keyword">const</span> dist <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">"dist"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read package.json from the project root</span>
<span class="token keyword">const</span> packageJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>
  <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token string">"package.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Extend any manually added named exports</span>
<span class="token keyword">const</span> exports <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>packageJson<span class="token punctuation">.</span>exports <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Search for all index files in src directory and add</span>
<span class="token comment">// named exports for the generated types and imports</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> index <span class="token keyword">of</span> <span class="token keyword">await</span> <span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">"src/**/index.ts"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> exportPath <span class="token operator">=</span> index<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^src(.*?)\/[^/]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">".$1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  exports<span class="token punctuation">[</span>exportPath<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">types</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>exportPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.d.ts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token keyword">import</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>exportPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Write the published package.json into the dist directory</span>
<span class="token keyword">await</span> <span class="token function">writeFile</span><span class="token punctuation">(</span>
  <span class="token function">join</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> <span class="token string">"package.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      <span class="token operator">...</span>packageJson<span class="token punctuation">,</span>
      exports<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">"utf8"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Copy other files required in the published package</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> file <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token string">"README.md"</span><span class="token punctuation">,</span> <span class="token string">"LICENCE"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">copyFile</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">join</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></copy-to-clipboard>
<p>This script can be run during the build and publishing of the library.
Everything in the <code>dist</code> directory can be ignored from source control and now
there's no risk of forgetting to update the entry points or exposing library
internals that may be subject to change in the future.</p>

  </main>

  <footer class="post-footer">
    <div class="container">
      <div class="licence">
        <p xmlns:cc="http://creativecommons.org/ns#">This post by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://philparsons.co.uk/">Phil Parsons</a> is licensed under <a href="https://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer">CC BY 4.0</a></p>
      </div>
    </div>
  </footer>
</article>

<back-to-top data-scroll-behavior="smooth"></back-to-top>


  

<script src="https://cdn.jsdelivr.net/npm/@parsonic/all@1.1.3/min.js" defer=""></script>

</body>

</html>
